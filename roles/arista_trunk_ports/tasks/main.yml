---

- name: "Get LLDP neighbors"
  arista.eos.eos_command:
    commands: 
      - command: show lldp neighbors
        output: json
  register: lldp_neighbors

### OUTPUT ###
# ok: [SW-1] =>
#   lldp_neighbors:
#     changed: false
#     failed: false
#     stdout:
#     - lldpNeighbors:
#       - neighborDevice: fw-1
#         neighborPort: port2
#         port: Ethernet1
#         ttl: 120
#       - neighborDevice: sw-2
#         neighborPort: Ethernet1
#         port: Ethernet2
#         ttl: 120
#       - neighborDevice: sw-2
#         neighborPort: Management0
#         port: Management0
#         ttl: 120

# Make FW-SW and SW-SW trunk ports
- name: "Configure trunk ports"
  arista.eos.eos_config:
    lines: switchport mode trunk
    parents: interface {{ nbr.port }}
  loop: "{{ lldp_neighbors.stdout.0.lldpNeighbors }}"
  loop_control:
    loop_var: nbr
  when: 
    - '"Ethernet" in nbr.port'
    - '"fw-" in nbr.neighborDevice or "sw-" in nbr.neighborDevice'
